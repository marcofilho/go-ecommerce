basePath: /api
definitions:
  dto.AssignCategoryRequest:
    properties:
      category_id:
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
    type: object
  dto.AuthResponse:
    properties:
      email:
        type: string
      expires_at:
        type: string
      name:
        type: string
      role:
        type: string
      token:
        type: string
      user_id:
        type: string
    type: object
  dto.CategoryListResponse:
    properties:
      data:
        items:
          $ref: '#/definitions/dto.CategoryResponse'
        type: array
      pagination:
        $ref: '#/definitions/dto.Pagination'
    type: object
  dto.CategoryRequest:
    properties:
      name:
        example: Electronics
        type: string
    type: object
  dto.CategoryResponse:
    properties:
      id:
        type: string
      name:
        type: string
    type: object
  dto.CreateOrderRequest:
    properties:
      customer_id:
        example: 123
        type: integer
      products:
        items:
          $ref: '#/definitions/dto.OrderItemRequest'
        type: array
    type: object
  dto.ErrorResponse:
    properties:
      error:
        type: string
    type: object
  dto.OrderItemRequest:
    properties:
      product_id:
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
      quantity:
        example: 2
        type: integer
      variant_id:
        description: 'Optional: order specific variant'
        example: 660e8400-e29b-41d4-a716-446655440000
        type: string
    type: object
  dto.OrderItemResponse:
    properties:
      product_id:
        type: string
      quantity:
        type: integer
      subtotal:
        type: number
    type: object
  dto.OrderListResponse:
    properties:
      data:
        items:
          $ref: '#/definitions/dto.OrderResponse'
        type: array
      pagination:
        $ref: '#/definitions/dto.Pagination'
    type: object
  dto.OrderResponse:
    properties:
      created_at:
        type: string
      customer_id:
        type: integer
      id:
        type: string
      payment_status:
        type: string
      products:
        items:
          $ref: '#/definitions/dto.OrderItemResponse'
        type: array
      status:
        type: string
      total_price:
        type: number
      updated_at:
        type: string
    type: object
  dto.Pagination:
    properties:
      page:
        type: integer
      page_size:
        type: integer
      total:
        type: integer
      total_pages:
        type: integer
    type: object
  dto.ProductListResponse:
    properties:
      data:
        items:
          $ref: '#/definitions/dto.ProductResponse'
        type: array
      pagination:
        $ref: '#/definitions/dto.Pagination'
    type: object
  dto.ProductRequest:
    properties:
      description:
        example: High-performance laptop
        type: string
      name:
        example: Laptop
        type: string
      price:
        example: 999.99
        type: number
      quantity:
        example: 50
        type: integer
    type: object
  dto.ProductResponse:
    properties:
      categories:
        items:
          $ref: '#/definitions/dto.CategoryResponse'
        type: array
      created_at:
        type: string
      description:
        type: string
      id:
        type: string
      name:
        type: string
      price:
        type: number
      quantity:
        type: integer
      updated_at:
        type: string
      variants:
        items:
          $ref: '#/definitions/dto.ProductVariantResponse'
        type: array
    type: object
  dto.ProductVariantListResponse:
    properties:
      data:
        items:
          $ref: '#/definitions/dto.ProductVariantResponse'
        type: array
      pagination:
        $ref: '#/definitions/dto.Pagination'
    type: object
  dto.ProductVariantRequest:
    properties:
      price_override:
        description: Optional price override
        example: 99.99
        type: number
      product_id:
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
      quantity:
        example: 10
        type: integer
      variant_name:
        example: Color
        type: string
      variant_value:
        example: Red
        type: string
    type: object
  dto.ProductVariantResponse:
    properties:
      created_at:
        type: string
      has_override:
        description: Indicates if price is overridden
        type: boolean
      id:
        type: string
      price:
        description: Effective price (override or base product price)
        type: number
      price_override:
        description: The override value if set
        type: number
      product_id:
        type: string
      quantity:
        type: integer
      updated_at:
        type: string
      variant_name:
        type: string
      variant_value:
        type: string
    type: object
  dto.UpdateOrderStatusRequest:
    properties:
      status:
        example: completed
        type: string
    type: object
  entity.PaymentStatus:
    enum:
    - unpaid
    - paid
    - failed
    type: string
    x-enum-varnames:
    - Unpaid
    - Paid
    - Failed
  entity.PaymentWebhookRequest:
    properties:
      order_id:
        type: string
      payment_status:
        $ref: '#/definitions/entity.PaymentStatus'
      timestamp:
        type: integer
      transaction_id:
        type: string
    type: object
  entity.WebhookLog:
    properties:
      createdAt:
        type: string
      id:
        type: string
      nextRetryAt:
        type: string
      orderID:
        type: string
      paymentStatus:
        $ref: '#/definitions/entity.PaymentStatus'
      processedAt:
        type: string
      rawPayload:
        type: string
      retryCount:
        type: integer
      status:
        $ref: '#/definitions/entity.WebhookStatus'
      transactionID:
        type: string
    type: object
  entity.WebhookStatus:
    enum:
    - pending
    - processing
    - completed
    - failed
    type: string
    x-enum-varnames:
    - WebhookStatusPending
    - WebhookStatusProcessing
    - WebhookStatusCompleted
    - WebhookStatusFailed
  handler.LoginRequest:
    properties:
      email:
        type: string
      password:
        type: string
    type: object
  handler.MessageResponse:
    properties:
      message:
        type: string
    type: object
  handler.RegisterRequest:
    properties:
      email:
        type: string
      name:
        type: string
      password:
        type: string
      role:
        example: customer
        type: string
    type: object
host: localhost:8080
info:
  contact:
    email: marco@example.com
    name: API Support
  description: RESTful API for managing products and orders in an e-commerce system
    with payment webhook integration
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  termsOfService: http://swagger.io/terms/
  title: Go E-Commerce API
  version: "1.0"
paths:
  /auth/login:
    post:
      consumes:
      - application/json
      description: Authenticate user and return JWT token
      parameters:
      - description: Login credentials
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.AuthResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: User login
      tags:
      - auth
  /auth/register:
    post:
      consumes:
      - application/json
      description: Create a new user account. Public registration creates customer
        accounts. Creating admin accounts requires admin authentication.
      parameters:
      - description: Registration data
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/handler.RegisterRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/dto.AuthResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "401":
          description: Unauthorized - Admin authentication required for admin role
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "403":
          description: Forbidden - Only admins can create admin accounts
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Register a new user
      tags:
      - auth
  /categories:
    get:
      consumes:
      - application/json
      description: Get all categories with pagination and sorting
      parameters:
      - default: 1
        description: Page number
        in: query
        name: page
        type: integer
      - default: 10
        description: Page size
        in: query
        name: page_size
        type: integer
      - default: '"name"'
        description: Sort by field (name, created_at)
        in: query
        name: sort_by
        type: string
      - default: '"asc"'
        description: Sort order (asc, desc)
        in: query
        name: sort_order
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.CategoryListResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: List all categories
      tags:
      - categories
    post:
      consumes:
      - application/json
      description: Create a new category (Admin only)
      parameters:
      - description: Category details
        in: body
        name: category
        required: true
        schema:
          $ref: '#/definitions/dto.CategoryRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/dto.CategoryResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Create a new category
      tags:
      - categories
  /orders:
    get:
      consumes:
      - application/json
      description: Get a paginated list of orders with optional filtering and sorting
      parameters:
      - default: 1
        description: Page number
        in: query
        name: page
        type: integer
      - default: 10
        description: Items per page
        in: query
        name: page_size
        type: integer
      - default: '"created_at"'
        description: Sort by field (created_at, total_price)
        in: query
        name: sort_by
        type: string
      - default: '"desc"'
        description: Sort order (asc, desc)
        in: query
        name: sort_order
        type: string
      - description: Filter by status (pending, cancelled, completed)
        in: query
        name: status
        type: string
      - description: Filter by payment status (unpaid, paid, failed)
        in: query
        name: payment_status
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.OrderListResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: List all orders
      tags:
      - orders
    post:
      consumes:
      - application/json
      description: Create a new order with the provided products
      parameters:
      - description: Order information
        in: body
        name: order
        required: true
        schema:
          $ref: '#/definitions/dto.CreateOrderRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/dto.OrderResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Create a new order
      tags:
      - orders
  /orders/{id}:
    get:
      consumes:
      - application/json
      description: Get detailed information about a specific order
      parameters:
      - description: Order ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.OrderResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Get an order by ID
      tags:
      - orders
  /orders/{id}/payment-history:
    get:
      consumes:
      - application/json
      description: Retrieves all payment webhook events for a specific order
      parameters:
      - description: Order ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/entity.WebhookLog'
            type: array
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Get payment webhook history
      tags:
      - payments
  /orders/{id}/status:
    put:
      consumes:
      - application/json
      description: Update the status of an existing order
      parameters:
      - description: Order ID
        in: path
        name: id
        required: true
        type: string
      - description: New status
        in: body
        name: status
        required: true
        schema:
          $ref: '#/definitions/dto.UpdateOrderStatusRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.OrderResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Update order status
      tags:
      - orders
  /payment-webhook:
    post:
      consumes:
      - application/json
      description: Receives payment status updates from payment processor with HMAC
        signature verification and replay attack prevention
      parameters:
      - description: HMAC-SHA256 signature of the request body
        in: header
        name: X-Payment-Signature
        required: true
        type: string
      - description: Payment webhook data with timestamp
        in: body
        name: webhook
        required: true
        schema:
          $ref: '#/definitions/entity.PaymentWebhookRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized - Invalid signature or timestamp
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Process payment webhook
      tags:
      - payments
  /product_variants/{id}:
    get:
      consumes:
      - application/json
      description: Get detailed information about a specific product variant
      parameters:
      - description: Product Variant ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.ProductVariantResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Get a product variant by ID
      tags:
      - product_variants
  /products:
    get:
      consumes:
      - application/json
      description: Get a paginated list of products with optional filtering and sorting
      parameters:
      - default: 1
        description: Page number
        in: query
        name: page
        type: integer
      - default: 10
        description: Items per page
        in: query
        name: page_size
        type: integer
      - default: '"created_at"'
        description: Sort by field (name, price, created_at)
        in: query
        name: sort_by
        type: string
      - default: '"desc"'
        description: Sort order (asc, desc)
        in: query
        name: sort_order
        type: string
      - default: true
        description: Filter products in stock only
        in: query
        name: in_stock_only
        type: boolean
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.ProductListResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: List all products
      tags:
      - products
    post:
      consumes:
      - application/json
      description: Create a new product with the provided information
      parameters:
      - description: Product information
        in: body
        name: product
        required: true
        schema:
          $ref: '#/definitions/dto.ProductRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/dto.ProductResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Create a new product
      tags:
      - products
  /products/{id}:
    delete:
      consumes:
      - application/json
      description: Delete a product by ID
      parameters:
      - description: Product ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Delete a product
      tags:
      - products
    get:
      consumes:
      - application/json
      description: Get detailed information about a specific product
      parameters:
      - description: Product ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.ProductResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Get a product by ID
      tags:
      - products
    put:
      consumes:
      - application/json
      description: Update an existing product's information
      parameters:
      - description: Product ID
        in: path
        name: id
        required: true
        type: string
      - description: Product information
        in: body
        name: product
        required: true
        schema:
          $ref: '#/definitions/dto.ProductRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.ProductResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Update a product
      tags:
      - products
  /products/{id}/categories:
    get:
      consumes:
      - application/json
      description: Get all categories assigned to a product
      parameters:
      - description: Product ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/dto.CategoryResponse'
            type: array
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: Get product categories
      tags:
      - products
    post:
      consumes:
      - application/json
      description: Assign a category to a product (Admin only)
      parameters:
      - description: Product ID
        in: path
        name: id
        required: true
        type: string
      - description: Category assignment
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/dto.AssignCategoryRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/handler.MessageResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Assign category to product
      tags:
      - products
  /products/{id}/categories/{category_id}:
    delete:
      consumes:
      - application/json
      description: Remove a category from a product (Admin only)
      parameters:
      - description: Product ID
        in: path
        name: id
        required: true
        type: string
      - description: Category ID
        in: path
        name: category_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/handler.MessageResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Remove category from product
      tags:
      - products
  /products/{id}/variants:
    get:
      consumes:
      - application/json
      description: Get a paginated list of product variants for a specific product
        with sorting
      parameters:
      - description: Product ID
        in: path
        name: id
        required: true
        type: string
      - default: 1
        description: Page number
        in: query
        name: page
        type: integer
      - default: 10
        description: Items per page
        in: query
        name: page_size
        type: integer
      - default: '"created_at"'
        description: Sort by field (variant_name, created_at)
        in: query
        name: sort_by
        type: string
      - default: '"asc"'
        description: Sort order (asc, desc)
        in: query
        name: sort_order
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.ProductVariantListResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      summary: List all product variants for a product
      tags:
      - product_variants
    post:
      consumes:
      - application/json
      description: Create a new product variant with the provided information. Requires
        admin privileges.
      parameters:
      - description: Product ID
        in: path
        name: id
        required: true
        type: string
      - description: Product variant information
        in: body
        name: product_variant
        required: true
        schema:
          $ref: '#/definitions/dto.ProductVariantRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/dto.ProductVariantResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "403":
          description: Forbidden - requires product:create permission
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Create a new product variant
      tags:
      - product_variants
  /variants/{variant_id}:
    delete:
      consumes:
      - application/json
      description: Delete a product variant by ID. Requires admin privileges.
      parameters:
      - description: Product Variant ID
        in: path
        name: variant_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "403":
          description: Forbidden - requires product:delete permission
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Delete a product variant
      tags:
      - product_variants
    put:
      consumes:
      - application/json
      description: Update an existing product variant's information. Requires admin
        privileges.
      parameters:
      - description: Product Variant ID
        in: path
        name: variant_id
        required: true
        type: string
      - description: Product Variant information
        in: body
        name: product_variant
        required: true
        schema:
          $ref: '#/definitions/dto.ProductVariantRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/dto.ProductVariantResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "403":
          description: Forbidden - requires product:update permission
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/dto.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Update a product variant
      tags:
      - product_variants
schemes:
- http
securityDefinitions:
  BearerAuth:
    description: Type "Bearer" followed by a space and JWT token.
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
